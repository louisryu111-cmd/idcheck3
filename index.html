<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Banyan Tree Busan Concierge</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <style>
        :root { --primary-color: #8E7958; --bg-color: #121212; --card-bg: #1E1E1E; --text-color: #FFFFFF; }
        body { margin: 0; padding: 0; background-color: #000; font-family: 'Noto Sans KR', sans-serif; color: var(--text-color); -webkit-tap-highlight-color: transparent; }
        #app-container { max-width: 480px; margin: 0 auto; background-color: var(--bg-color); height: 100vh; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in { animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ë¡œê·¸ì¸ í™”ë©´ë“¤ --- */
        #auth-selection-screen, #security-screen, #code-auth-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; z-index: 1100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .logo-intro { font-size: 22px; font-weight: 300; letter-spacing: 2px; margin-bottom: 50px; color: var(--primary-color); text-align: center; line-height: 1.5; }
        .auth-btn { width: 80%; background-color: var(--card-bg); color: #fff; border: 1px solid var(--primary-color); padding: 15px; border-radius: 10px; font-size: 16px; margin-bottom: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* --- ì‹¤ì‹œê°„ ì•ˆë©´ ì¸ì‹ UI --- */
        .camera-container { position: relative; width: 260px; height: 260px; border-radius: 50%; overflow: hidden; border: 2px solid var(--primary-color); margin-bottom: 20px; background: #1a1a1a; }
        #video-feed { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        #face-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transform: scaleX(-1); }
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--primary-color); box-shadow: 0 0 15px var(--primary-color); animation: scan 2s infinite linear; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        /* --- ì…ë ¥ UI --- */
        .input-group { width: 80%; position: relative; display: flex; align-items: center; margin-bottom: 20px; }
        .code-input { width: 100%; background: #1a1a1a; border: 1px solid #444; color: #fff; padding: 18px; font-size: 18px; border-radius: 10px; text-align: center; outline: none; }
        .voice-btn { position: absolute; right: 15px; color: var(--primary-color); cursor: pointer; background: none; border: none; }

        /* --- ë©”ì¸ í™ˆ --- */
        #main-app { display: none; flex: 1; flex-direction: column; padding: 25px 20px; overflow-y: auto; padding-bottom: 100px; }
        .hotel-name { font-size: 18px; font-weight: bold; color: var(--primary-color); margin-bottom: 10px; }
        .welcome-text { font-size: 20px; margin-bottom: 30px; line-height: 1.4; font-weight: 300; }
        
        /* ê·¸ë¦¬ë“œ ë©”ë‰´ */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }
        .menu-item { background-color: var(--card-bg); border-radius: 15px; height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #333; transition: 0.3s; }
        .menu-item:active { transform: scale(0.95); background-color: #2a2a2a; }
        .menu-item i { font-size: 35px; color: var(--primary-color); margin-bottom: 10px; }
        .menu-item span { font-size: 14px; text-align: center; color: #eee; font-weight: 500; }

        /* í•˜ë‹¨ ë‹¨ì¼ ë©”ë‰´ (Map) */
        .bottom-nav { position: absolute; bottom: 0; left: 0; width: 100%; height: 85px; background-color: #111; display: none; flex-direction: column; align-items: center; justify-content: center; border-top: 1px solid #222; z-index: 100; }
        .map-trigger { color: var(--primary-color); display: flex; flex-direction: column; align-items: center; cursor: pointer; margin-top: 5px; }
        .map-trigger i { font-size: 28px; }
        
        /* ì €ì‘ê¶Œ í‘œì‹œ ì˜ì—­ */
        .copyright-area { font-size: 10px; color: #555; text-align: center; margin-top: 10px; letter-spacing: -0.2px; line-height: 1.4; padding: 0 20px; }

        /* ì„œë¸Œ í™”ë©´ */
        .sub-screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); z-index: 500; padding: 25px 20px; box-sizing: border-box; flex-direction: column; }
        .screen-header { display: flex; align-items: center; margin-bottom: 25px; font-size: 18px; font-weight: bold; color: var(--primary-color); }
        .screen-header i { margin-right: 15px; cursor: pointer; }

        /* ë°”í…€ ì‹œíŠ¸ */
        #bottom-sheet-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1200; }
        #bottom-sheet { position: absolute; bottom: -100%; left: 0; width: 100%; background-color: #1a1a1a; border-radius: 25px 25px 0 0; z-index: 1201; transition: bottom 0.3s ease; padding: 25px; box-sizing: border-box; }
        .sub-list-item { padding: 20px 0; border-bottom: 1px solid #2a2a2a; display: flex; justify-content: space-between; color: #ddd; font-size: 16px; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="auth-selection-screen">
        <div class="logo-intro">BANYAN TREE<br><span style="font-size:14px; color:#aaa;">BUSAN HAEUNDAE</span></div>
        <button class="auth-btn" onclick="initFaceID()"><i class="material-icons">face</i>ì•ˆë©´ì¸ì‹ ë¡œê·¸ì¸</button>
        <button class="auth-btn" onclick="openCodeAuth()"><i class="material-icons">vpn_key</i>ì¸ì¦ ì½”ë“œë¡œ ë¡œê·¸ì¸</button>
    </div>

    <div id="security-screen" style="display:none;">
        <div class="logo-intro" id="face-title">FACE ID VERIFICATION</div>
        <div class="camera-container">
            <video id="video-feed" playsinline muted></video>
            <canvas id="face-canvas"></canvas>
            <div class="scan-line" id="scan-bar" style="display:none;"></div>
        </div>
        <div id="face-status" style="color:var(--primary-color); margin-bottom:20px; text-align:center; font-size:14px;">ì¹´ë©”ë¼ ëª¨ë¸ ë¡œë“œ ì¤‘...</div>
        <button class="auth-btn" style="width:50%; font-size:14px; background:none;" onclick="location.reload()">ì·¨ì†Œ</button>
    </div>

    <div id="code-auth-screen" style="display:none;">
        <div class="logo-intro">MEMBER ACCESS</div>
        <div class="input-group">
            <input type="text" id="access-code" class="code-input" placeholder="">
            <button class="voice-btn" onclick="startVoiceRecognition('access-code')"><i class="material-icons">mic</i></button>
        </div>
        <button class="auth-btn" onclick="verifyCode()" style="background:var(--primary-color)">ë¡œê·¸ì¸</button>
        <div style="margin-top:20px; color:#555; font-size:12px; cursor:pointer;" onclick="location.reload()">ë’¤ë¡œ ê°€ê¸°</div>
    </div>

    <div id="main-app">
        <div class="hotel-name">Banyantree Busan Haeundae</div>
        <div class="welcome-text">ë°˜ê°‘ìŠµë‹ˆë‹¤, íšŒì›ë‹˜.<br><b>ì»¨ì‹œì–´ì§€ ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.</b></div>
        
        <div class="menu-grid">
            <div class="menu-item" onclick="showSubScreen('concierge')"><i class="material-icons">room_service</i><span>Concierge<br>Service</span></div>
            <div class="menu-item" onclick="showSubScreen('hotel')"><i class="material-icons">apartment</i><span>Hotel<br>Service</span></div>
            <div class="menu-item" onclick="window.open('https://www.banyantree.com/booking', '_blank')"><i class="material-icons">event_available</i><span>Member<br>Booking</span></div>
            <div class="menu-item" onclick="checkLocationForValet()"><i class="material-icons">directions_car</i><span>Valet<br>Parking</span></div>
        </div>
    </div>

    <div id="concierge-screen" class="sub-screen fade-in">
        <div class="screen-header"><i class="material-icons" onclick="closeSubScreen()">arrow_back</i>Concierge Service</div>
        <div class="menu-grid">
            <div class="menu-item" onclick="openSheet('tour')"><i class="material-icons">map</i><span>4 Season Tour</span></div>
            <div class="menu-item" onclick="alert('Kids ì „ìš© ì„œë¹„ìŠ¤ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.')"><i class="material-icons">child_friendly</i><span>Kids</span></div>
            <div class="menu-item" onclick="alert('ì„¸ì°¨ ìš”ì²­ í˜ì´ì§€ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.')"><i class="material-icons">local_car_wash</i><span>Car Wash</span></div>
            <div class="menu-item" onclick="alert('ì¸ê·¼ ê±°ì  ë³‘ì› ì •ë³´ë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤.')"><i class="material-icons">medical_services</i><span>Hospital<br>Information</span></div>
        </div>
    </div>

    <div id="hotel-screen" class="sub-screen fade-in">
        <div class="screen-header"><i class="material-icons" onclick="closeSubScreen()">arrow_back</i>Hotel Service</div>
        <div class="menu-grid">
            <div class="menu-item" onclick="alert('Dining ì˜ˆì•½ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">restaurant</i><span>Dining</span></div>
            <div class="menu-item" onclick="alert('Lounge ì•ˆë‚´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">local_bar</i><span>Lounge</span></div>
            <div class="menu-item" onclick="alert('Wellness ì•ˆë‚´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">spa</i><span>Wellness</span></div>
            <div class="menu-item" onclick="alert('Facilities ì•ˆë‚´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">pool</i><span>Facilities</span></div>
            <div class="menu-item" onclick="alert('Kids í”„ë¡œê·¸ë¨ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">child_care</i><span>Kids</span></div>
            <div class="menu-item" onclick="alert('ì—°íšŒì¥/ì›¨ë”© ìƒë‹´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">celebration</i><span>ì—°íšŒì¥ ë° ì›¨ë”©</span></div>
        </div>
    </div>

    <div class="bottom-nav" id="bottom-nav">
        <div class="map-trigger" onclick="window.open('https://drive.google.com/file/d/1ICKC21t37n6B5ek9WQc_NNsLAfjAFfMo/view')">
            <i class="material-icons">map</i>
            <span>Residences Map</span>
        </div>
        <div class="copyright-area">
            Â© 2024 Banyan Tree Busan Haeundae. All Rights Reserved.<br>
            Managed by Banyan Tree Hotels & Resorts.
        </div>
    </div>

    <div id="bottom-sheet-overlay" onclick="closeSheet()"></div>
    <div id="bottom-sheet">
        <div id="sheet-title" style="color:var(--primary-color); font-weight:bold; margin-bottom:15px; font-size:18px;"></div>
        <div id="sheet-content"></div>
    </div>
</div>

<script>
    const GOOGLE_SHEET_DB = "https://docs.google.com/spreadsheets/d/1X1O3wvZ2j_sUeJSifv0Uiex55kAzFEhtZ5vgTlgmIwY/edit";

    // 1. ì½”ë“œ ì¸ì¦ (í™•ì¥ëœ ì½”ë“œ ë¦¬ìŠ¤íŠ¸)
    function verifyCode() {
        const codes = ["foryou", "for you", "í¬ìœ ", "í¬ ìœ "];
        const input = document.getElementById('access-code').value.trim().toLowerCase();
        
        if (codes.includes(input)) {
            loginSuccess();
        } else {
            alert("ìœ íš¨í•˜ì§€ ì•Šì€ ì¸ì¦ ì½”ë“œì…ë‹ˆë‹¤.");
        }
    }

    // 2. ì•ˆë©´ì¸ì‹ ì‹œìŠ¤í…œ (ì‹¤ì œ ì–¼êµ´ ê°ì§€ ì—°ë™)
    async function initFaceID() {
        document.getElementById('auth-selection-screen').style.display = 'none';
        document.getElementById('security-screen').style.display = 'flex';
        const status = document.getElementById('face-status');
        
        try {
            // ëª¨ë¸ ë¡œë“œ
            status.innerText = "ì•ˆì „í•œ ì ‘ì†ì„ ìœ„í•´ ì–¼êµ´ ì¸ì‹ ì—”ì§„ì„ ë¡œë“œí•©ë‹ˆë‹¤...";
            await Promise.all([
                faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/'),
                faceapi.nets.faceRecognitionNet.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/')
            ]);
            startFaceDetection();
        } catch (e) {
            status.innerText = "HTTPS í™˜ê²½ì´ ì•„ë‹ˆê±°ë‚˜ ì—”ì§„ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
            console.error(e);
        }
    }

    async function startFaceDetection() {
        const video = document.getElementById('video-feed');
        const status = document.getElementById('face-status');
        const scanBar = document.getElementById('scan-bar');
        
        const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
        video.srcObject = stream;
        video.play();

        status.innerText = "ì–¼êµ´ì„ í”„ë ˆì„ ì•ˆìœ¼ë¡œ ë§ì¶°ì£¼ì„¸ìš”.";

        const detectLoop = setInterval(async () => {
            const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions());
            
            if (detections.length > 0) {
                // ì–¼êµ´ì´ ê°ì§€ë¨!
                scanBar.style.display = 'block';
                status.innerText = "íšŒì› ì •ë³´ ëŒ€ì¡° ì¤‘... (Google DB ì—°ê²°)";
                
                // ì‹¤ì œ ëŒ€ì¡° ì‹œë®¬ë ˆì´ì…˜ (êµ¬ê¸€ ì‹œíŠ¸ í™•ì¸ ì ˆì°¨)
                clearInterval(detectLoop);
                setTimeout(() => {
                    console.log("Sheet DB ëŒ€ì¡° ì™„ë£Œ: ", GOOGLE_SHEET_DB);
                    stream.getTracks().forEach(track => track.stop());
                    loginSuccess();
                }, 3000);
            }
        }, 1000);
    }

    // 3. ìŒì„± ì¸ì‹ (STT)
    function startVoiceRecognition(targetId) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) return alert("ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
        
        const recognition = new SpeechRecognition();
        recognition.lang = 'ko-KR';
        recognition.start();
        
        recognition.onresult = (e) => {
            document.getElementById(targetId).value = e.results[0][0].transcript;
        };
    }

    // 4. ê³µí†µ ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
    function loginSuccess() {
        document.getElementById('auth-selection-screen').style.display = 'none';
        document.getElementById('security-screen').style.display = 'none';
        document.getElementById('code-auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('bottom-nav').style.display = 'flex';
    }

    // 5. í™”ë©´ ì œì–´ ë° ê¸°íƒ€ ë¡œì§
    function showSubScreen(type) {
        document.getElementById('main-app').style.display = 'none';
        document.getElementById(type + '-screen').style.display = 'flex';
    }
    function closeSubScreen() {
        document.querySelectorAll('.sub-screen').forEach(s => s.style.display = 'none');
        document.getElementById('main-app').style.display = 'flex';
    }
    function checkLocationForValet() {
        navigator.geolocation.getCurrentPosition((pos) => {
            const dist = Math.sqrt(Math.pow(pos.coords.latitude - 35.1618, 2) + Math.pow(pos.coords.longitude - 129.1709, 2));
            if (dist < 0.009) alert("í˜¸í…” ë‚´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ë°œë › ì¶œì°¨ ìš”ì²­ í˜ì´ì§€ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.");
            else alert("í˜¸í…” ë‚´ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
        });
    }

    function openSheet(mode) {
        const overlay = document.getElementById('bottom-sheet-overlay');
        const sheet = document.getElementById('bottom-sheet');
        const content = document.getElementById('sheet-content');
        const title = document.getElementById('sheet-title');
        
        title.innerText = "4 Season Tour (Google Drive)";
        content.innerHTML = `
            <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1Ax4O2b49CM5I6-KnMebXjz9r8PHlgUmz/view')"><span>ğŸŒ¸ Spring Course</span><i class="material-icons">chevron_right</i></div>
            <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1m1nqU2eRtS4YHKAPKqYEekQn7KF0i_sp/view')"><span>ğŸŒŠ Summer Course</span><i class="material-icons">chevron_right</i></div>
            <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1d84lGgWJuSJUh3F-AJThTIq-B-t9usRd/view')"><span>ğŸ‚ Autumn Course</span><i class="material-icons">chevron_right</i></div>
            <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1YpcJG6XhzOfaR_e0iDOY0y2yXt5f0t8S/view')"><span>â„ï¸ Winter Course</span><i class="material-icons">chevron_right</i></div>
        `;
        overlay.style.display = 'block';
        setTimeout(() => sheet.style.bottom = '0', 50);
    }
    function closeSheet() {
        document.getElementById('bottom-sheet').style.bottom = '-100%';
        setTimeout(() => document.getElementById('bottom-sheet-overlay').style.display = 'none', 300);
    }
</script>
</body>
</html>