<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Banyan Tree Busan Concierge</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-color: #8E7958;
            --bg-color: #121212;
            --card-bg: #1E1E1E;
            --text-color: #FFFFFF;
        }

        body {
            margin: 0; padding: 0; background-color: #000;
            font-family: 'Noto Sans KR', sans-serif;
            -webkit-tap-highlight-color: transparent;
            color: var(--text-color);
        }

        #app-container {
            max-width: 480px; margin: 0 auto; background-color: var(--bg-color);
            height: 100vh; position: relative; overflow: hidden;
            display: flex; flex-direction: column;
        }

        .fade-in { animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- 1. ë¡œê·¸ì¸/ì¸ì¦ ì„ íƒ í™”ë©´ --- */
        #auth-selection-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; z-index: 1100; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
        }
        .logo-intro {
            font-size: 22px; font-weight: 300; letter-spacing: 2px;
            margin-bottom: 50px; color: var(--primary-color); text-align: center;
        }
        .auth-btn {
            width: 80%; background-color: var(--card-bg); color: #fff;
            border: 1px solid var(--primary-color); padding: 15px; border-radius: 10px;
            font-size: 16px; margin-bottom: 15px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .auth-btn:active { background-color: #333; }

        /* --- 2. ì•ˆë©´ì¸ì‹ í™”ë©´ --- */
        #security-screen {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; z-index: 1000; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .camera-container {
            position: relative; width: 220px; height: 220px; border-radius: 50%;
            overflow: hidden; border: 2px solid #333; margin-bottom: 20px;
            background-color: #1a1a1a; display: flex; align-items: center; justify-content: center;
        }
        #video-feed { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); display: none; }
        .scan-line {
            position: absolute; top: 0; left: 0; width: 100%; height: 5px;
            background-color: var(--primary-color); box-shadow: 0 0 10px var(--primary-color);
            animation: scan 2s infinite linear; display: none;
        }
        @keyframes scan { 0% { top: 0%; opacity: 0; } 50% { opacity: 1; } 100% { top: 100%; opacity: 0; } }
        .status-text { font-size: 14px; color: #ccc; margin-top: 10px; text-align: center; }
        .data-warning { font-size: 11px; color: #888; margin-top: 20px; text-align: center; line-height: 1.4; }

        /* --- 3. ì½”ë“œ ì…ë ¥ í™”ë©´ --- */
        #code-auth-screen {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000; z-index: 1000; flex-direction: column;
            align-items: center; justify-content: center; padding: 20px; box-sizing: border-box;
        }
        .code-input {
            width: 80%; background: #1a1a1a; border: 1px solid #444; color: #fff;
            padding: 15px; font-size: 18px; border-radius: 10px; text-align: center; margin-bottom: 20px;
            outline: none;
        }
        .code-input:focus { border-color: var(--primary-color); }
        .submit-btn {
            width: 80%; background-color: var(--primary-color); color: #fff; border: none;
            padding: 15px; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .back-text { margin-top: 20px; color: #888; text-decoration: underline; font-size: 13px; cursor: pointer; }

        /* --- 4. ë©”ì¸ í™”ë©´ --- */
        #main-app { display: none; flex: 1; flex-direction: column; padding: 25px 20px; overflow-y: auto; padding-bottom: 90px; }
        header { margin-bottom: 20px; }
        .hotel-name { font-size: 18px; font-weight: bold; color: var(--primary-color); }
        .welcome-text { font-size: 20px; margin: 20px 0; line-height: 1.4; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .menu-item {
            background-color: var(--card-bg); border-radius: 12px; height: 90px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .menu-item i { font-size: 28px; color: var(--primary-color); margin-bottom: 8px; }
        .menu-item span { font-size: 13px; color: #eee; }

        /* --- 5. ì»¨ì‹œì–´ì§€ ì„¸ë¶€ í™”ë©´ --- */
        #concierge-screen {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-color); z-index: 400; padding: 25px 20px; box-sizing: border-box;
            flex-direction: column; overflow-y: auto;
        }
        .screen-header { display: flex; align-items: center; margin-bottom: 20px; font-size: 18px; font-weight: bold; color: var(--primary-color); }
        .screen-header i { margin-right: 10px; cursor: pointer; }
        .section-title { font-size: 15px; color: #aaa; margin: 20px 0 10px 0; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        .list-item {
            background-color: var(--card-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center; cursor: pointer;
        }
        .list-item span { font-size: 14px; color: #eee; }
        .list-item i { color: var(--primary-color); font-size: 20px; }

        /* --- 6. ë°œë › ì°¨ëŸ‰ë²ˆí˜¸ ì…ë ¥ í™”ë©´ --- */
        #valet-screen {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-color); z-index: 500; padding: 30px 20px; box-sizing: border-box;
            flex-direction: column; align-items: center; justify-content: center;
        }
        .valet-notice {
            background-color: #2a251a; border: 1px solid var(--primary-color); color: #ddd;
            padding: 15px; border-radius: 10px; font-size: 13px; line-height: 1.6; margin-bottom: 30px; text-align: center;
        }

        /* --- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ (ë°œë › ë° ë§µ) --- */
        .bottom-nav {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 70px;
            background-color: #1a1a1a; display: flex; align-items: center;
            border-top: 1px solid #333; z-index: 50;
        }
        .nav-item {
            flex: 1; color: var(--primary-color); text-align: center; font-size: 13px; font-weight: bold;
            cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100%; border-right: 1px solid #333;
        }
        .nav-item:last-child { border-right: none; }
        .nav-item i { font-size: 24px; margin-bottom: 4px; }

        /* ë°”í…€ ì‹œíŠ¸ (ë‹¤ì´ë‹, ì›°ë‹ˆìŠ¤ ë“±) */
        #bottom-sheet-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; }
        #bottom-sheet { position: absolute; bottom: -100%; left: 0; width: 100%; background-color: #1a1a1a; border-radius: 20px 20px 0 0; z-index: 101; transition: bottom 0.3s ease; }
        .sheet-header { padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .sheet-content { padding: 10px 20px 30px 20px; max-height: 60vh; overflow-y: auto;}
        .sub-item { padding: 18px 0; border-bottom: 1px solid #2a2a2a; display: flex; justify-content: space-between; color: #ddd; cursor: pointer; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="auth-selection-screen">
        <div class="logo-intro">BANYAN TREE<br><span style="font-size:14px; color:#aaa;">BUSAN HAEUNDAE</span></div>
        <button class="auth-btn" onclick="showFaceAuth()"><i class="material-icons">face</i>ì•ˆë©´ì¸ì‹ ë¡œê·¸ì¸</button>
        <button class="auth-btn" onclick="showCodeAuth()"><i class="material-icons">dialpad</i>ì¸ì¦ ì½”ë“œë¡œ ë¡œê·¸ì¸</button>
        <div class="data-warning">í•´ë‹¹ ì„œë¹„ìŠ¤ëŠ” ëª¨ë°”ì¼ ë°ì´í„°ê°€ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    </div>

    <div id="security-screen" class="fade-in">
        <div class="logo-intro">BANYAN TREE</div>
        <div class="camera-container">
            <i class="material-icons" id="camera-icon" style="font-size:60px; color:#555;">face</i>
            <video id="video-feed" playsinline muted></video>
            <div class="scan-line" id="scan-line"></div>
        </div>
        <button class="submit-btn" id="start-btn" onclick="startCamera()" style="width:auto;">ì•ˆë©´ì¸ì‹ ì‹œì‘</button>
        <div class="status-text" id="status-msg">ë³¸ì¸ í™•ì¸ì„ ìœ„í•´ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
        <div class="back-text" onclick="backToAuthSelection()">ë’¤ë¡œ ê°€ê¸°</div>
    </div>

    <div id="code-auth-screen" class="fade-in">
        <div class="logo-intro">BANYAN TREE</div>
        <input type="text" id="access-code" class="code-input" placeholder="ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        <button class="submit-btn" onclick="verifyCode()">í™•ì¸</button>
        <div class="back-text" onclick="backToAuthSelection()">ë’¤ë¡œ ê°€ê¸°</div>
    </div>

    <div id="main-app" class="fade-in">
        <header><div class="hotel-name">Banyantree Busan Haeundae</div></header>
        <div class="welcome-text">ë°˜ê°‘ìŠµë‹ˆë‹¤, íšŒì›ë‹˜.<br><span style="color:var(--primary-color); font-weight: bold;">ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</span></div>

        <div class="menu-grid">
            <div class="menu-item" onclick="openConciergeScreen()"><i class="material-icons">luggage</i><span>Concierge</span></div>
            <div class="menu-item" onclick="openSubMenu('dining')"><i class="material-icons">restaurant</i><span>Dining</span></div>
            <div class="menu-item" onclick="openSubMenu('lounge')"><i class="material-icons">wine_bar</i><span>Lounge</span></div>
            <div class="menu-item" onclick="openSubMenu('wellness')"><i class="material-icons">spa</i><span>Wellness</span></div>
            <div class="menu-item" onclick="openSubMenu('facilities')"><i class="material-icons">domain</i><span>Facilities</span></div>
            <div class="menu-item" onclick="window.open('https://www.banyantree.com/booking', '_blank')"><i class="material-icons">event_available</i><span>Member booking</span></div>
        </div>
    </div>

    <div id="concierge-screen" class="fade-in">
        <div class="screen-header">
            <i class="material-icons" onclick="closeConciergeScreen()">arrow_back</i>
            Concierge Services
        </div>
        
        <div class="section-title">ë¶€ì‚° 4ê³„ì ˆ ê´€ê´‘ ì•ˆë‚´</div>
        <div class="list-item" onclick="window.open('https://drive.google.com/file/d/1Ax4O2b49CM5I6-KnMebXjz9r8PHlgUmz/view?usp=drive_link', '_blank')"><span>ğŸŒ¸ ë´„ (Spring)</span><i class="material-icons">open_in_new</i></div>
        <div class="list-item" onclick="window.open('https://drive.google.com/file/d/1m1nqU2eRtS4YHKAPKqYEekQn7KF0i_sp/view?usp=drive_link', '_blank')"><span>ğŸŒŠ ì—¬ë¦„ (Summer)</span><i class="material-icons">open_in_new</i></div>
        <div class="list-item" onclick="window.open('https://drive.google.com/file/d/1d84lGgWJuSJUh3F-AJThTIq-B-t9usRd/view?usp=drive_link', '_blank')"><span>ğŸ‚ ê°€ì„ (Autumn)</span><i class="material-icons">open_in_new</i></div>
        <div class="list-item" onclick="window.open('https://drive.google.com/file/d/1YpcJG6XhzOfaR_e0iDOY0y2yXt5f0t8S/view?usp=drive_link', '_blank')"><span>â„ï¸ ê²¨ìš¸ (Winter)</span><i class="material-icons">open_in_new</i></div>

        <div class="section-title">ê¸°íƒ€ ì„œë¹„ìŠ¤</div>
        <div class="list-item" onclick="alert('í‚¤ì¦ˆ í”„ë¡œê·¸ë¨ ì˜ˆì•½ í˜ì´ì§€ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.')"><span>ğŸ§¸ í‚¤ì¦ˆ í´ëŸ½ (Kids Club)</span><i class="material-icons">chevron_right</i></div>
        <div class="list-item" onclick="alert('ì„¸ì°¨ ì˜ˆì•½ í˜ì´ì§€ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.')"><span>ğŸš— ì„¸ì°¨ ì„œë¹„ìŠ¤ (Car Wash)</span><i class="material-icons">chevron_right</i></div>
    </div>

    <div id="valet-screen" class="fade-in">
        <div class="valet-notice">
            ë³¸ ì„œë¹„ìŠ¤ëŠ” ë°œë › ì¶œì°¨ë§Œ ê°€ëŠ¥í•˜ë©°,<br>ê·€í•˜ì˜ ìœ„ì¹˜ê°€ ë°˜ì–€íŠ¸ë¦¬ ë¶€ì‚° í•´ìš´ëŒ€ í˜¸í…” ë‚´ì— ê³„ì‹¤ ë•Œ ì„œë¹„ìŠ¤ê°€ ì§„í–‰ë©ë‹ˆë‹¤.
        </div>
        <input type="text" id="car-number" class="code-input" placeholder="ì°¨ëŸ‰ ë²ˆí˜¸ ì…ë ¥ (ì˜ˆ: 12ê°€ 3456)">
        <button class="submit-btn" onclick="sendValetDuve()">ì¶œì°¨ ìš”ì²­í•˜ê¸°</button>
        <div class="back-text" onclick="closeValetScreen()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</div>
    </div>

    <div id="bottom-sheet-overlay" onclick="closeSubMenu()"></div>
    <div id="bottom-sheet">
        <div class="sheet-header"><span id="sheet-title" style="font-weight:bold; color:var(--primary-color);">Menu</span><i class="material-icons" onclick="closeSubMenu()">close</i></div>
        <div class="sheet-content" id="sheet-content"></div>
    </div>

    <div class="bottom-nav" id="bottom-nav" style="display:none;">
        <div class="nav-item" onclick="window.open('https://drive.google.com/file/d/1ICKC21t37n6B5ek9WQc_NNsLAfjAFfMo/view?usp=drive_link', '_blank')">
            <i class="material-icons">map</i>MAP
        </div>
        <div class="nav-item" onclick="checkLocationForValet()">
            <i class="material-icons">directions_car</i>Valet
        </div>
    </div>
</div>

<script>
    // ========================================================
    // [ì„¤ì • ê°’]
    // ========================================================
    const TARGET_LAT = 35.1618;  // ë‹¬ë§ì´ ë§¥ë„ë‚ ë“œ
    const TARGET_LNG = 129.1709;
    const NOTICE_MSG = "ë³¸ ì„œë¹„ìŠ¤ëŠ” ë°œë › ì¶œì°¨ë§Œ ê°€ëŠ¥í•˜ë©°, ê·€í•˜ì˜ ìœ„ì¹˜ê°€ ë°˜ì–€íŠ¸ë¦¬ ë¶€ì‚° í•´ìš´ëŒ€ í˜¸í…” ë‚´ì— ê³„ì‹¤ ë•Œ ì„œë¹„ìŠ¤ê°€ ì§„í–‰ë©ë‹ˆë‹¤.";
    
    // ì¶”í›„ ì‚¬ìš©í•  Duve ì‹œìŠ¤í…œ ì—°ë™ ì£¼ì†Œ (ì„ì‹œ)
    const DUVE_CHAT_URL = "https://duve.com/chat/placeholder"; 

    // êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„° ì—°ë™ URL (ì‹œíŠ¸ ID: 1X1O3wvZ2j_sUeJSifv0Uiex55kAzFEhtZ5vgTlgmIwY)
    const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/1X1O3wvZ2j_sUeJSifv0Uiex55kAzFEhtZ5vgTlgmIwY/gviz/tq?tqx=out:csv";

    const SUB_MENU_DATA = {
        dining: { title: "Dining", items: [ { name: "ì˜¬ë¦¬ì•„", url: "#" }, { name: "ì”¨í‘¸ë“œ ë§ˆì¼“", url: "#" }, { name: "ì‚¬í”„ë¡ ", url: "#" }, { name: "ë²„í‹°ê³ ", url: "#" } ] },
        lounge: { title: "Lounge", items: [ { name: "ë²„í‹°ê³  ë°”", url: "#" }, { name: "ë¡œë¹„ ë¼ìš´ì§€", url: "#" }, { name: "ë¦¬ì•„ìŠ¤ í’€ ë°”", url: "#" }, { name: "í¬ëŸ¬ìŠ¤íŠ¸", url: "#" } ] },
        wellness: { title: "Wellness", items: [ { name: "ì‹¤ë‚´ ìˆ˜ì˜ì¥", url: "#" }, { name: "ë¦¬ì•„ìŠ¤ í’€", url: "#" }, { name: "ì¸í”¼ë‹ˆí‹° í’€", url: "#" }, { name: "ë¦¬ì•„ìŠ¤ íƒˆë¼ì†Œ í’€", url: "#" }, { name: "ë°˜ì–€íŠ¸ë¦¬ ìŠ¤íŒŒ", url: "#" }, { name: "ë°˜ì–€íŠ¸ë¦¬ ê°¤ëŸ¬ë¦¬", url: "#" }, { name: "í”¼íŠ¸ë‹ˆìŠ¤ í´ëŸ½", url: "#" }, { name: "ì‹¤ë‚´ ê³¨í”„ ì—°ìŠµì¥", url: "#" }, { name: "ìš”ê°€ì‹¤", url: "#" }, { name: "ë‚¨ì„± ì‚¬ìš°ë‚˜", url: "#" }, { name: "ì—¬ì„± ì‚¬ìš°ë‚˜", url: "#" } ] },
        facilities: { title: "Facilities", items: [ { name: "ê·¸ëœë“œ ë³¼ë£¸", url: "#" }, { name: "ì‹ ë¶€ëŒ€ê¸°ì‹¤", url: "#" }, { name: "íë°±ì‹¤", url: "#" }, { name: "ë” ì±„í”Œ", url: "#" }, { name: "ì•„ë„ˆìŠ¤ ë¼ìš´ì§€", url: "#" }, { name: "ë ˆì¸ì €ìŠ¤ í´ëŸ½", url: "#" } ] }
    };

    // ========================================================
    // ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜
    // ========================================================
    function showFaceAuth() {
        document.getElementById('auth-selection-screen').style.display = 'none';
        document.getElementById('security-screen').style.display = 'flex';
    }

    function showCodeAuth() {
        document.getElementById('auth-selection-screen').style.display = 'none';
        document.getElementById('code-auth-screen').style.display = 'flex';
    }

    function backToAuthSelection() {
        document.getElementById('security-screen').style.display = 'none';
        document.getElementById('code-auth-screen').style.display = 'none';
        document.getElementById('auth-selection-screen').style.display = 'flex';
    }

    // êµ¬ê¸€ ì‹œíŠ¸ ì½”ë“œë¡œ ì¸ì¦
    async function verifyCode() {
        const code = document.getElementById('access-code').value.trim();
        if(!code) return alert("ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        
        try {
            // êµ¬ê¸€ ì‹œíŠ¸ë¥¼ CSV í˜•íƒœë¡œ ê°€ì ¸ì™€ì„œ ì½”ë“œê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
            const response = await fetch(GOOGLE_SHEET_CSV_URL);
            const data = await response.text();
            
            if (data.includes(code)) {
                unlockApp();
            } else {
                alert("ë“±ë¡ë˜ì§€ ì•Šì€ ì½”ë“œì´ê±°ë‚˜, êµ¬ê¸€ ì‹œíŠ¸ ê¶Œí•œ(ë§í¬ê°€ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ì ë³´ê¸°) ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            }
        } catch (e) {
            console.error("ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨", e);
            // CORS ì—ëŸ¬ ë“±ì´ ë‚  ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ Fallback ì²˜ë¦¬ (ì‹œë®¬ë ˆì´ì…˜ íŒ¨ìŠ¤)
            alert("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸ í™˜ê²½ ê°•ì œ ì§„ì…)");
            unlockApp();
        }
    }

    // ì•ˆë©´ ì¸ì‹ ì‹¤í–‰
    function startCamera() {
        const video = document.getElementById('video-feed');
        const startBtn = document.getElementById('start-btn');
        const statusMsg = document.getElementById('status-msg');

        startBtn.style.display = 'none';
        statusMsg.innerText = "ì¹´ë©”ë¼ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...";

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } }).then(stream => {
                video.srcObject = stream;
                video.style.display = 'block'; 
                document.getElementById('camera-icon').style.display = 'none';
                document.getElementById('scan-line').style.display = 'block';
                video.play();
                statusMsg.innerText = "ì–¼êµ´ì„ ìŠ¤ìº”í•©ë‹ˆë‹¤...";
                setTimeout(unlockApp, 2500); // 2.5ì´ˆ í›„ ì„±ê³µ
            }).catch(() => {
                alert("ì¹´ë©”ë¼ ê¶Œí•œì´ ì—†ê±°ë‚˜ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê°•ì œ ì§„ì…í•©ë‹ˆë‹¤.");
                unlockApp();
            });
        } else {
            alert("ì¹´ë©”ë¼ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” í™˜ê²½ì…ë‹ˆë‹¤.");
            unlockApp();
        }
    }

    function unlockApp() {
        document.getElementById('security-screen').style.display = 'none';
        document.getElementById('code-auth-screen').style.display = 'none';
        document.getElementById('auth-selection-screen').style.display = 'none';
        
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('bottom-nav').style.display = 'flex';
        
        const video = document.getElementById('video-feed');
        if(video.srcObject) {
            video.srcObject.getTracks().forEach(track => track.stop());
        }
    }

    // ========================================================
    // ì»¨ì‹œì–´ì§€ í™”ë©´ ì œì–´
    // ========================================================
    function openConciergeScreen() {
        document.getElementById('main-app').style.display = 'none';
        document.getElementById('concierge-screen').style.display = 'flex';
    }
    function closeConciergeScreen() {
        document.getElementById('concierge-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
    }

    // ========================================================
    // ë°œë › ì„œë¹„ìŠ¤ (ìœ„ì¹˜ ê²€ì¦ í›„ Duve ì—°ë™)
    // ========================================================
    function checkLocationForValet() {
        if (!navigator.geolocation) {
            alert("ì´ ê¸°ê¸°ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return;
        }

        navigator.geolocation.getCurrentPosition((pos) => {
            const latDiff = pos.coords.latitude - TARGET_LAT;
            const lngDiff = pos.coords.longitude - TARGET_LNG;
            const dist = Math.sqrt(Math.pow(latDiff, 2) + Math.pow(lngDiff, 2));
            
            // 0.009 = ì•½ 1km
            if (dist < 0.009) {
                showValetScreen();
            } else {
                alert(NOTICE_MSG);
            }
        }, (err) => {
            alert(NOTICE_MSG); // ê¶Œí•œ ê±°ë¶€ ì‹œ
        }, { enableHighAccuracy: true });
    }

    function showValetScreen() {
        document.getElementById('main-app').style.display = 'none';
        document.getElementById('concierge-screen').style.display = 'none';
        document.getElementById('valet-screen').style.display = 'flex';
    }

    function closeValetScreen() {
        document.getElementById('valet-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('car-number').value = ''; 
    }

    function sendValetDuve() {
        const carNum = document.getElementById('car-number').value.trim();
        if (!carNum) {
            alert("ì°¨ëŸ‰ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }
        // ì¶”í›„ Duve ì‹œìŠ¤í…œ í˜•ì‹ì— ë§ê²Œ íŒŒë¼ë¯¸í„° ì—…ë°ì´íŠ¸ í•„ìš”
        const msg = encodeURIComponent(`[ë°œë › ì¶œì°¨ ìš”ì²­] ì°¨ëŸ‰ë²ˆí˜¸: ${carNum}`);
        window.open(`${DUVE_CHAT_URL}?message=${msg}`, '_blank');
    }

    // ========================================================
    // ë°”í…€ ì‹œíŠ¸ (ì„œë¸Œ ë©”ë‰´)
    // ========================================================
    function openSubMenu(cat) {
        const data = SUB_MENU_DATA[cat];
        document.getElementById('sheet-title').innerText = data.title;
        const content = document.getElementById('sheet-content');
        content.innerHTML = '';
        data.items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'sub-item';
            div.innerHTML = `<span>${item.name}</span><i class="material-icons">chevron_right</i>`;
            div.onclick = () => window.open(item.url, '_blank');
            content.appendChild(div);
        });
        document.getElementById('bottom-sheet-overlay').style.display = 'block';
        setTimeout(() => document.getElementById('bottom-sheet').style.bottom = '0', 10);
    }

    function closeSubMenu() {
        document.getElementById('bottom-sheet').style.bottom = '-100%';
        setTimeout(() => document.getElementById('bottom-sheet-overlay').style.display = 'none', 300);
    }
</script>
</body>
</html>