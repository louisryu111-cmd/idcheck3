<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Banyan Tree Busan Concierge</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root { --primary-color: #8E7958; --bg-color: #121212; --card-bg: #1E1E1E; --text-color: #FFFFFF; }
        body { margin: 0; padding: 0; background-color: #000; font-family: 'Noto Sans KR', sans-serif; color: var(--text-color); -webkit-tap-highlight-color: transparent; }
        #app-container { max-width: 480px; margin: 0 auto; background-color: var(--bg-color); height: 100vh; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .fade-in { animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ë¡œê·¸ì¸ ë° ì¸ì¦ --- */
        #auth-selection-screen, #security-screen, #code-auth-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; z-index: 1100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .logo-intro { font-size: 22px; font-weight: 300; letter-spacing: 2px; margin-bottom: 50px; color: var(--primary-color); text-align: center; line-height: 1.5; }
        .auth-btn { width: 80%; background-color: var(--card-bg); color: #fff; border: 1px solid var(--primary-color); padding: 15px; border-radius: 10px; font-size: 16px; margin-bottom: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        /* --- ì¹´ë©”ë¼ í™”ë©´ --- */
        .camera-container { position: relative; width: 240px; height: 240px; border-radius: 50%; overflow: hidden; border: 2px solid var(--primary-color); margin-bottom: 20px; background: #1a1a1a; }
        #video-feed { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--primary-color); box-shadow: 0 0 15px var(--primary-color); animation: scan 2s infinite linear; display: none; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }

        /* --- ì…ë ¥ì°½ ë° ìŒì„± ë²„íŠ¼ --- */
        .input-group { width: 80%; position: relative; display: flex; align-items: center; margin-bottom: 20px; }
        .code-input { width: 100%; background: #1a1a1a; border: 1px solid #444; color: #fff; padding: 15px; padding-right: 50px; font-size: 18px; border-radius: 10px; text-align: center; outline: none; }
        .voice-btn { position: absolute; right: 10px; color: var(--primary-color); cursor: pointer; background: none; border: none; }
        .voice-btn.listening { color: #ff4444; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* --- ë©”ì¸ í™ˆ --- */
        #main-app { display: none; flex: 1; flex-direction: column; padding: 25px 20px; overflow-y: auto; padding-bottom: 90px; }
        .hotel-name { font-size: 18px; font-weight: bold; color: var(--primary-color); margin-bottom: 20px; }
        .welcome-text { font-size: 20px; margin-bottom: 25px; line-height: 1.4; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .menu-item { background-color: var(--card-bg); border-radius: 12px; height: 110px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #333; transition: 0.2s; }
        .menu-item:active { background-color: #2a2a2a; border-color: var(--primary-color); }
        .menu-item i { font-size: 32px; color: var(--primary-color); margin-bottom: 10px; }
        .menu-item span { font-size: 13px; text-align: center; color: #ddd; font-weight: 500; }

        /* --- ì„œë¸Œ í™”ë©´ë“¤ --- */
        .sub-screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); z-index: 500; padding: 25px 20px; box-sizing: border-box; flex-direction: column; overflow-y: auto; }
        .screen-header { display: flex; align-items: center; margin-bottom: 25px; font-size: 18px; font-weight: bold; color: var(--primary-color); }
        .screen-header i { margin-right: 15px; cursor: pointer; }

        /* --- ë°œë ›/ë„¤ë¹„ê²Œì´ì…˜ --- */
        .bottom-nav { position: absolute; bottom: 0; left: 0; width: 100%; height: 70px; background-color: #1a1a1a; display: flex; border-top: 1px solid #333; z-index: 100; }
        .nav-item { flex: 1; color: #888; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; cursor: pointer; }
        .nav-item.active { color: var(--primary-color); }
        .nav-item i { font-size: 24px; margin-bottom: 3px; }

        /* ë°”í…€ ì‹œíŠ¸ */
        #bottom-sheet-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1200; }
        #bottom-sheet { position: absolute; bottom: -100%; left: 0; width: 100%; background-color: #1a1a1a; border-radius: 20px 20px 0 0; z-index: 1201; transition: bottom 0.3s ease; padding: 20px; box-sizing: border-box; }
        .sub-list-item { padding: 18px 0; border-bottom: 1px solid #2a2a2a; display: flex; justify-content: space-between; color: #ddd; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="auth-selection-screen">
        <div class="logo-intro">BANYAN TREE<br><span style="font-size:14px; color:#aaa;">BUSAN HAEUNDAE</span></div>
        <button class="auth-btn" onclick="openFaceAuth()"><i class="material-icons">face</i>ì•ˆë©´ì¸ì‹ ë¡œê·¸ì¸</button>
        <button class="auth-btn" onclick="openCodeAuth()"><i class="material-icons">vpn_key</i>ì¸ì¦ ì½”ë“œë¡œ ë¡œê·¸ì¸</button>
    </div>

    <div id="security-screen" style="display:none;">
        <div class="logo-intro">FACE ID SCANNING</div>
        <div class="camera-container">
            <video id="video-feed" playsinline muted></video>
            <div class="scan-line" id="face-scan-line"></div>
        </div>
        <div id="face-status" style="color:var(--primary-color); margin-bottom:20px; text-align:center;">ì •ë©´ì„ ì‘ì‹œí•´ ì£¼ì„¸ìš”</div>
        <button class="auth-btn" style="width:60%;" onclick="location.reload()">ì·¨ì†Œ</button>
    </div>

    <div id="code-auth-screen" style="display:none;">
        <div class="logo-intro">ENTER PASSCODE</div>
        <div class="input-group">
            <input type="text" id="access-code" class="code-input" placeholder="">
            <button class="voice-btn" onclick="startVoiceRecognition('access-code')"><i class="material-icons">mic</i></button>
        </div>
        <button class="auth-btn" onclick="verifyCode()" style="background:var(--primary-color)">ë¡œê·¸ì¸</button>
        <div style="margin-top:20px; color:#666; font-size:12px; cursor:pointer;" onclick="location.reload()">ë’¤ë¡œ ê°€ê¸°</div>
    </div>

    <div id="main-app">
        <div class="hotel-name">Banyantree Busan Haeundae</div>
        <div class="welcome-text">ë°˜ê°‘ìŠµë‹ˆë‹¤, íšŒì›ë‹˜.<br><b>ì–´ë–¤ ì„œë¹„ìŠ¤ë¥¼ ë„ì™€ë“œë¦´ê¹Œìš”?</b></div>
        <div class="menu-grid">
            <div class="menu-item" onclick="showSubScreen('concierge')"><i class="material-icons">room_service</i><span>Concierge<br>Service</span></div>
            <div class="menu-item" onclick="showSubScreen('hotel')"><i class="material-icons">apartment</i><span>Hotel<br>Service</span></div>
            <div class="menu-item" onclick="window.open('https://www.banyantree.com/booking', '_blank')"><i class="material-icons">event_available</i><span>Member<br>Booking</span></div>
            <div class="menu-item" onclick="checkLocationForValet()"><i class="material-icons">directions_car</i><span>Valet<br>Parking</span></div>
        </div>
    </div>

    <div id="concierge-screen" class="sub-screen fade-in">
        <div class="screen-header"><i class="material-icons" onclick="closeSubScreen()">arrow_back</i>Concierge Service</div>
        <div class="menu-grid">
            <div class="menu-item" onclick="openSheet('tour')"><i class="material-icons">map</i><span>4 Season Tour</span></div>
            <div class="menu-item" onclick="alert('Kids ì„œë¹„ìŠ¤ ì¤€ë¹„ ì¤‘')"><i class="material-icons">child_friendly</i><span>Kids</span></div>
            <div class="menu-item" onclick="alert('ì„¸ì°¨ ì˜ˆì•½ ì„œë¹„ìŠ¤')"><i class="material-icons">local_car_wash</i><span>Car Wash</span></div>
            <div class="menu-item" onclick="alert('ì¸ê·¼ ëŒ€í˜• ë³‘ì› ì •ë³´ ì•ˆë‚´')"><i class="material-icons">medical_services</i><span>Hospital<br>Information</span></div>
        </div>
    </div>

    <div id="hotel-screen" class="sub-screen fade-in">
        <div class="screen-header"><i class="material-icons" onclick="closeSubScreen()">arrow_back</i>Hotel Service</div>
        <div class="menu-grid">
            <div class="menu-item" onclick="alert('Dining ì˜ˆì•½ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">restaurant</i><span>Dining</span></div>
            <div class="menu-item" onclick="alert('Lounge ì•ˆë‚´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">local_bar</i><span>Lounge</span></div>
            <div class="menu-item" onclick="alert('Wellness ì„œë¹„ìŠ¤ ì•ˆë‚´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">spa</i><span>Wellness</span></div>
            <div class="menu-item" onclick="alert('Facilities ì•ˆë‚´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">pool</i><span>Facilities</span></div>
            <div class="menu-item" onclick="alert('í˜¸í…” ë‚´ Kids í”„ë¡œê·¸ë¨ ì˜ˆì•½ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">child_care</i><span>Kids</span></div>
            <div class="menu-item" onclick="alert('ì—°íšŒì¥ ë° ì›¨ë”© ìƒë‹´ í˜ì´ì§€ ì—°ê²° ì˜ˆì •')"><i class="material-icons">celebration</i><span>ì—°íšŒì¥ ë° ì›¨ë”©</span></div>
        </div>
    </div>

    <div id="valet-screen" class="sub-screen fade-in">
        <div class="screen-header"><i class="material-icons" onclick="closeSubScreen()">arrow_back</i>Valet Service</div>
        <div style="text-align:center; margin-bottom:30px; font-size:13px; color:#aaa; line-height:1.6;">
            â€œë³¸ ì„œë¹„ìŠ¤ëŠ” ë°œë › ì¶œì°¨ ì „ìš©ì´ë©°,<br>í˜¸í…” ë‚´ ì²´ë¥˜ ì‹œì—ë§Œ ìš”ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤.â€
        </div>
        <div class="input-group" style="width:100%;">
            <input type="text" id="car-number" class="code-input" placeholder="ì°¨ëŸ‰ë²ˆí˜¸ ì…ë ¥">
            <button class="voice-btn" onclick="startVoiceRecognition('car-number')"><i class="material-icons">mic</i></button>
        </div>
        <button class="auth-btn" style="width:100%; background:var(--primary-color);" onclick="sendValet()">ì¶œì°¨ ìš”ì²­í•˜ê¸°</button>
    </div>

    <div class="bottom-nav" id="bottom-nav" style="display:none;">
        <div class="nav-item active" onclick="closeSubScreen()"><i class="material-icons">home</i>Home</div>
        <div class="nav-item" onclick="window.open('https://drive.google.com/file/d/1ICKC21t37n6B5ek9WQc_NNsLAfjAFfMo/view')"><i class="material-icons">map</i>Map</div>
        <div class="nav-item" onclick="checkLocationForValet()"><i class="material-icons">directions_car</i>Valet</div>
    </div>

    <div id="bottom-sheet-overlay" onclick="closeSheet()"></div>
    <div id="bottom-sheet">
        <div id="sheet-title" style="color:var(--primary-color); font-weight:bold; margin-bottom:15px; font-size:18px;"></div>
        <div id="sheet-content"></div>
    </div>
</div>

<script>
    // 1. ì½”ë“œ ì¸ì¦ ë¡œì§
    function verifyCode() {
        const val = document.getElementById('access-code').value.trim().toUpperCase();
        if (val === "FOR YOU") {
            loginSuccess();
        } else {
            alert("ì¸ì¦ ì½”ë“œê°€ í‹€ë¦½ë‹ˆë‹¤.");
        }
    }

    // 2. ì•ˆë©´ì¸ì‹ (ì¹´ë©”ë¼ ì‹¤ì œ êµ¬ë™ ë° êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„° ëŒ€ì¡° ì‹œë®¬ë ˆì´ì…˜)
    const GOOGLE_SHEET_URL = "https://docs.google.com/spreadsheets/d/1X1O3wvZ2j_sUeJSifv0Uiex55kAzFEhtZ5vgTlgmIwY/edit";

    async function openFaceAuth() {
        document.getElementById('auth-selection-screen').style.display = 'none';
        document.getElementById('security-screen').style.display = 'flex';
        const video = document.getElementById('video-feed');
        const scanLine = document.getElementById('face-scan-line');
        
        try {
            // ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ ìš”ì²­
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
            video.srcObject = stream;
            video.play();
            scanLine.style.display = 'block';

            // ì‹¤ì œ êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‹œë„ (ì‹œë®¬ë ˆì´ì…˜)
            // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” êµ¬ê¸€ API ë˜ëŠ” CSV ë‚´ë³´ë‚´ê¸° ë§í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ íŒŒì‹±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            console.log("DB í™•ì¸ ì¤‘: ", GOOGLE_SHEET_URL);

            setTimeout(() => {
                // ì¸ì¦ ì„±ê³µ ì²˜ë¦¬
                stream.getTracks().forEach(t => t.stop());
                loginSuccess();
            }, 4000); 

        } catch (err) {
            alert("ì¹´ë©”ë¼ë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. HTTPS í™˜ê²½ì¸ì§€ í™•ì¸í•˜ê±°ë‚˜ ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”.");
            location.reload();
        }
    }

    function openCodeAuth() {
        document.getElementById('auth-selection-screen').style.display = 'none';
        document.getElementById('code-auth-screen').style.display = 'flex';
    }

    function loginSuccess() {
        document.getElementById('auth-selection-screen').style.display = 'none';
        document.getElementById('security-screen').style.display = 'none';
        document.getElementById('code-auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('bottom-nav').style.display = 'flex';
    }

    // 3. ìŒì„± ì¸ì‹ ê¸°ëŠ¥ (STT)
    function startVoiceRecognition(targetId) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return;
        }
        const recognition = new SpeechRecognition();
        recognition.lang = 'ko-KR';
        const btn = event.currentTarget;
        
        btn.classList.add('listening');
        recognition.start();

        recognition.onresult = (event) => {
            const text = event.results[0][0].transcript;
            document.getElementById(targetId).value = text;
        };
        recognition.onend = () => btn.classList.remove('listening');
    }

    // 4. í™”ë©´ ì œì–´ ë¡œì§
    function showSubScreen(type) {
        document.getElementById('main-app').style.display = 'none';
        document.querySelectorAll('.sub-screen').forEach(s => s.style.display = 'none');
        document.getElementById(type + '-screen').style.display = 'flex';
    }

    function closeSubScreen() {
        document.querySelectorAll('.sub-screen').forEach(s => s.style.display = 'none');
        document.getElementById('main-app').style.display = 'flex';
    }

    // 5. ìœ„ì¹˜ ê¸°ë°˜ ë°œë › í™•ì¸ (ë‹¬ë§ì´ ë§¥ë„ë‚ ë“œ 1km)
    function checkLocationForValet() {
        if (!navigator.geolocation) {
            alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
            return;
        }
        navigator.geolocation.getCurrentPosition((pos) => {
            const dist = Math.sqrt(Math.pow(pos.coords.latitude - 35.1618, 2) + Math.pow(pos.coords.longitude - 129.1709, 2));
            if (dist < 0.009) showSubScreen('valet');
            else alert("ì„œë¹„ìŠ¤ ê°€ëŠ¥ ì§€ì—­ì´ ì•„ë‹™ë‹ˆë‹¤. (ë°˜ì–€íŠ¸ë¦¬ í˜¸í…” ë‚´ì—ì„œ ì‚¬ìš© ê°€ëŠ¥)");
        }, () => alert("ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”."));
    }

    function sendValet() {
        const num = document.getElementById('car-number').value;
        if(!num) return alert("ì°¨ëŸ‰ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        window.open(`https://wa.me/821050280073?text=ë°œë ›ì¶œì°¨ìš”ì²­:${encodeURIComponent(num)}`, '_blank');
    }

    // 6. ë°”í…€ ì‹œíŠ¸ (ê´€ê´‘ ì•ˆë‚´)
    function openSheet(mode) {
        const overlay = document.getElementById('bottom-sheet-overlay');
        const sheet = document.getElementById('bottom-sheet');
        const content = document.getElementById('sheet-content');
        const title = document.getElementById('sheet-title');
        
        title.innerText = "4 Season Tour Drive";
        content.innerHTML = `
            <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1Ax4O2b49CM5I6-KnMebXjz9r8PHlgUmz/view')"><span>ğŸŒ¸ Spring Drive</span><i class="material-icons">open_in_new</i></div>
            <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1m1nqU2eRtS4YHKAPKqYEekQn7KF0i_sp/view')"><span>ğŸŒŠ Summer Drive</span><i class="material-icons">open_in_new</i></div>
            <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1d84lGgWJuSJUh3F-AJThTIq-B-t9usRd/view')"><span>ğŸ‚ Autumn Drive</span><i class="material-icons">open_in_new</i></div>
            <div class="sub-list-item" onclick="window.open('https://drive.google.com/file/d/1YpcJG6XhzOfaR_e0iDOY0y2yXt5f0t8S/view')"><span>â„ï¸ Winter Drive</span><i class="material-icons">open_in_new</i></div>
        `;
        
        overlay.style.display = 'block';
        setTimeout(() => sheet.style.bottom = '0', 50);
    }

    function closeSheet() {
        document.getElementById('bottom-sheet').style.bottom = '-100%';
        setTimeout(() => document.getElementById('bottom-sheet-overlay').style.display = 'none', 300);
    }
</script>
</body>
</html>